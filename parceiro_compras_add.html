<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enviar RFQ por WhatsApp</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 600px; 
      margin: 2rem auto; 
      padding: 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1.8rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #555;
    }
    
    input[type="text"], textarea {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    
    input[type="text"]:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }
    
    fieldset { 
      border: 2px solid #e1e5e9; 
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    legend {
      font-weight: 600;
      color: #333;
      padding: 0 0.5rem;
    }
    
    .supplier-item {
      display: flex;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .supplier-item:last-child {
      border-bottom: none;
    }
    
    .supplier-item input[type="checkbox"] {
      margin-right: 0.75rem;
      transform: scale(1.2);
    }
    
    .supplier-item label {
      margin-bottom: 0;
      font-weight: normal;
      cursor: pointer;
      flex: 1;
    }
    
    button { 
      width: 100%;
      margin-top: 1rem; 
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .loading {
      display: none;
      text-align: center;
      margin-top: 1rem;
      color: #667eea;
      font-weight: 600;
    }
    
    .result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      display: none;
    }
    
    .result.success {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }
    
    .result.error {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }
    
    .help-text {
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.25rem;
    }
    
    @media (max-width: 640px) {
      body {
        margin: 1rem;
        padding: 0.5rem;
      }
      
      .container {
        padding: 1.5rem;
      }
      
      h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üõí Solicitar Cota√ß√£o por WhatsApp</h1>
    
    <form id="rfqForm">
      <div class="form-group">
        <label for="product">
          üì¶ Produto(s):
        </label>
        <textarea 
          id="product" 
          name="product" 
          placeholder="Digite o produto ou lista de produtos (um por linha)..." 
          required
        ></textarea>
        <div class="help-text">
          üí° Para m√∫ltiplos produtos, digite um por linha
        </div>
      </div>

      <fieldset>
        <legend>üë• Fornecedores</legend>
        <div class="supplier-item">
          <input type="checkbox" id="supplier1" name="suppliers" value="5511998821973" />
          <label for="supplier1">üè¢ Queiroz Distribuidora</label>
        </div>
        <div class="supplier-item">
          <input type="checkbox" id="supplier2" name="suppliers" value="5592985960527" />
          <label for="supplier2">üè™ Atacad√£o</label>
        </div>
        <div class="supplier-item">
          <input type="checkbox" id="supplier3" name="suppliers" value="5511998821973" />
          <label for="supplier3">üì¶ Distribuidora Analin</label>
        </div>
        <div class="supplier-item">
          <input type="checkbox" id="supplier4" name="suppliers" value="5592985960527" />
          <label for="supplier4">üöö Centralimp</label>
        </div>
        <div class="supplier-item">
          <input type="checkbox" id="supplier5" name="suppliers" value="5511998821973" />
          <label for="supplier5">üè¨ Distribuidora Metro</label>
        </div>
      </fieldset>

      <button type="submit" id="submitBtn">
        üì± Enviar RFQ por WhatsApp
      </button>
    </form>

    <div class="loading" id="loading">
      ‚è≥ Enviando mensagens... Por favor, aguarde.
    </div>

    <div class="result" id="result"></div>
  </div>

  <script>
    const form = document.getElementById('rfqForm');
    const loading = document.getElementById('loading');
    const result = document.getElementById('result');
    const submitBtn = document.getElementById('submitBtn');

    // URL do webhook n8n - ALTERE PARA SEU AMBIENTE
    const WEBHOOK_URL = 'http://localhost:5678/webhook/send-rfq';

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Coletar dados do formul√°rio
      const formData = new FormData(form);
      const product = formData.get('product').trim();
      const suppliers = formData.getAll('suppliers');
      
      // Valida√ß√µes
      if (!product) {
        showResult('Por favor, digite pelo menos um produto.', 'error');
        return;
      }
      
      if (!suppliers.length) {
        showResult('Selecione pelo menos um fornecedor.', 'error');
        return;
      }
      
      // Preparar dados para envio
      const requestData = {
        product: product,
        suppliers: suppliers
      };
      
      try {
        // Mostrar loading
        setLoading(true);
        
        // Enviar para o webhook n8n
        const response = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(requestData)
        });
        
        const responseData = await response.json();
        
        if (response.ok) {
          const message = responseData.message || 'RFQ enviada com sucesso!';
          const details = responseData.details || [];
          
          let resultMessage = `‚úÖ ${message}`;
          if (details.length > 0) {
            resultMessage += `\n\nüìä Detalhes:`;
            details.forEach(detail => {
              const status = detail.success ? '‚úÖ' : '‚ùå';
              resultMessage += `\n${status} ${detail.supplier}`;
            });
          }
          
          showResult(resultMessage, 'success');
          form.reset();
        } else {
          const errorMessage = responseData.message || `Erro HTTP: ${response.status}`;
          showResult(`‚ùå ${errorMessage}`, 'error');
        }
        
      } catch (error) {
        console.error('Erro na requisi√ß√£o:', error);
        showResult(`‚ùå Erro de conex√£o: ${error.message}`, 'error');
      } finally {
        setLoading(false);
      }
    });

    function setLoading(isLoading) {
      if (isLoading) {
        loading.style.display = 'block';
        submitBtn.disabled = true;
        submitBtn.textContent = '‚è≥ Enviando...';
        result.style.display = 'none';
      } else {
        loading.style.display = 'none';
        submitBtn.disabled = false;
        submitBtn.textContent = 'üì± Enviar RFQ por WhatsApp';
      }
    }

    function showResult(message, type) {
      result.textContent = message;
      result.className = `result ${type}`;
      result.style.display = 'block';
      
      // Auto-hide ap√≥s 10 segundos se for sucesso
      if (type === 'success') {
        setTimeout(() => {
          result.style.display = 'none';
        }, 10000);
      }
    }

    // Adicionar funcionalidade de "Selecionar Todos"
    const legend = document.querySelector('legend');
    const selectAllBtn = document.createElement('button');
    selectAllBtn.type = 'button';
    selectAllBtn.textContent = '‚úÖ Selecionar Todos';
    selectAllBtn.style.cssText = `
      float: right;
      background: none;
      border: 1px solid #667eea;
      color: #667eea;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      width: auto;
      margin: 0;
    `;
    
    selectAllBtn.addEventListener('click', () => {
      const checkboxes = document.querySelectorAll('input[name="suppliers"]');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      
      checkboxes.forEach(cb => cb.checked = !allChecked);
      selectAllBtn.textContent = allChecked ? '‚úÖ Selecionar Todos' : '‚ùå Desmarcar Todos';
    });
    
    legend.appendChild(selectAllBtn);
  </script>
</body>
</html>
